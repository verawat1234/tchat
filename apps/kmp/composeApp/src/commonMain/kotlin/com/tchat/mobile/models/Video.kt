package com.tchat.mobile.models

import kotlinx.datetime.Clock
import kotlinx.datetime.Instant

/**
 * Video Content Types - Following YouTube/TikTok Patterns
 * Based on web VideoTab.tsx implementation
 */

// Core Video Content Types
enum class VVVideoType {
    SHORT,  // TikTok-style vertical videos (‚â§60s)
    LONG    // YouTube-style horizontal videos (>60s)
}

enum class VVVideoCategory {
    ALL,
    TRENDING,
    FOOD,
    MUSIC,
    ENTERTAINMENT,
    EDUCATION,
    TRAVEL,
    BUSINESS,
    GAMING,
    TECH,
    LIFESTYLE,
    SPORTS,
    NEWS
}

enum class VVVideoQuality {
    AUTO,
    QUALITY_144P,
    QUALITY_240P,
    QUALITY_360P,
    QUALITY_480P,
    QUALITY_720P,
    QUALITY_1080P,
    QUALITY_1440P,
    QUALITY_2160P // 4K
}

// Video Content Models
data class VVVideoContent(
    val id: String,
    val title: String,
    val description: String,
    val thumbnail: String,
    val videoUrl: String?,
    val duration: String, // Format: "MM:SS" or "HH:MM:SS"
    val durationSeconds: Int,
    val views: Long,
    val likes: Long,
    val dislikes: Long,
    val comments: Long,
    val shares: Long,
    val bookmarks: Long,
    val channel: VVChannelInfo,
    val uploadTime: Instant,
    val uploadTimeFormatted: String, // "2 hours ago", "1 day ago"
    val isLive: Boolean = false,
    val isPrivate: Boolean = false,
    val isPremium: Boolean = false,
    val category: VVVideoCategory,
    val tags: List<String>,
    val type: VVVideoType,
    val language: String = "en",
    val subtitles: List<VVSubtitleTrack> = emptyList(),
    val qualities: List<VVVideoQuality> = listOf(VVVideoQuality.AUTO),
    val ageRestricted: Boolean = false,
    val monetized: Boolean = false,
    val sponsoredSegments: List<VVSponsoredSegment> = emptyList()
)

data class VVChannelInfo(
    val id: String,
    val name: String,
    val avatar: String,
    val banner: String? = null,
    val description: String,
    val subscribers: Long,
    val totalVideos: Int,
    val verified: Boolean,
    val category: VVVideoCategory,
    val joinedDate: String, // "Jan 2020"
    val location: String? = null,
    val isSubscribed: Boolean = false,
    val notificationsEnabled: Boolean = false,
    val website: String? = null,
    val socialLinks: Map<String, String> = emptyMap() // "twitter" -> "url"
)

data class VVSubtitleTrack(
    val language: String,
    val languageCode: String, // "en", "th", "zh"
    val url: String,
    val autoGenerated: Boolean = false
)

data class VVSponsoredSegment(
    val startTime: Int, // seconds
    val endTime: Int,   // seconds
    val type: VVSponsorType,
    val title: String? = null
)

enum class VVSponsorType {
    SPONSOR,
    SELF_PROMO,
    INTERACTION,
    INTRO,
    OUTRO,
    PREVIEW,
    MUSIC_OFFTOPIC,
    FILLER
}

// Engagement & Interaction Models
data class VVideoEngagement(
    val videoId: String,
    val isLiked: Boolean = false,
    val isDisliked: Boolean = false,
    val isBookmarked: Boolean = false,
    val watchTime: Int = 0, // seconds watched
    val watchPercentage: Float = 0f, // 0.0 to 1.0
    val lastWatchPosition: Int = 0, // seconds
    val reactions: List<VVVideoReaction> = emptyList(),
    val sharedTo: List<String> = emptyList(), // platform names
    val reportReason: String? = null
)

data class VVVideoReaction(
    val type: ReactionType,
    val timestamp: Int, // seconds in video
    val intensity: Float = 1f // 0.0 to 1.0
)

// ReactionType already defined in PostTypes.kt

// Comment System Models
data class VVVideoComment(
    val id: String,
    val videoId: String,
    val userId: String,
    val userAvatar: String,
    val username: String,
    val displayName: String?,
    val isVerified: Boolean = false,
    val content: String,
    val timestamp: Instant,
    val timeFormatted: String, // "2 hours ago"
    val likes: Long = 0,
    val dislikes: Long = 0,
    val replies: List<VVVideoComment> = emptyList(),
    val isEdited: Boolean = false,
    val isPinned: Boolean = false,
    val isHeartedByCreator: Boolean = false,
    val mentionedUsers: List<String> = emptyList(),
    val isReply: Boolean = false,
    val parentCommentId: String? = null
)

// Playlist & Collection Models
data class VVVideoPlaylist(
    val id: String,
    val title: String,
    val description: String,
    val thumbnail: String, // First video thumbnail or custom
    val creatorId: String,
    val creatorName: String,
    val videoIds: List<String>,
    val videoCount: Int,
    val totalDuration: String, // "1:23:45"
    val isPrivate: Boolean = false,
    val isCollaborative: Boolean = false,
    val createdAt: Instant,
    val updatedAt: Instant,
    val views: Long = 0,
    val category: VVVideoCategory = VVVideoCategory.ALL
)

data class VVWatchHistory(
    val userId: String,
    val videoId: String,
    val watchedAt: Instant,
    val watchDuration: Int, // seconds
    val watchPercentage: Float,
    val deviceType: String, // "mobile", "web", "tv"
    val quality: VVVideoQuality
)

// Subscription & Channel Models
data class VChannelSubscription(
    val userId: String,
    val channelId: String,
    val subscribedAt: Instant,
    val notificationsEnabled: Boolean = true,
    val bellIconEnabled: Boolean = false // "All" notifications vs "Personalized"
)

data class VChannelMembership(
    val userId: String,
    val channelId: String,
    val tier: VVMembershipTier,
    val joinedAt: Instant,
    val renewsAt: Instant?,
    val perks: List<VVMembershipPerk>
)

enum class VVMembershipTier {
    FREE,
    BRONZE,
    SILVER,
    GOLD,
    PLATINUM
}

data class VVMembershipPerk(
    val id: String,
    val title: String,
    val description: String,
    val type: VVPerkType
)

enum class VVPerkType {
    EARLY_ACCESS,
    EXCLUSIVE_CONTENT,
    CUSTOM_EMOJI,
    BADGE,
    COMMUNITY_ACCESS,
    LIVE_CHAT_PERKS,
    DISCORD_ACCESS
}

// Live Streaming Models
data class VLiveStream(
    val id: String,
    val title: String,
    val description: String,
    val thumbnail: String,
    val streamUrl: String,
    val chatUrl: String?,
    val channelId: String,
    val startedAt: Instant,
    val scheduledFor: Instant?,
    val currentViewers: Long,
    val peakViewers: Long,
    val totalViews: Long,
    val status: VVLiveStreamStatus,
    val category: VVVideoCategory,
    val tags: List<String>,
    val isPrivate: Boolean = false,
    val isPremium: Boolean = false,
    val ageRestricted: Boolean = false,
    val chatEnabled: Boolean = true,
    val chatSlowMode: Int = 0, // seconds between messages
    val subscribersOnly: Boolean = false,
    val followersOnly: Boolean = false
)

enum class VVLiveStreamStatus {
    SCHEDULED,
    LIVE,
    ENDED,
    CANCELLED
}

data class VLiveChatMessage(
    val id: String,
    val streamId: String,
    val userId: String,
    val username: String,
    val displayName: String?,
    val userAvatar: String,
    val isVerified: Boolean = false,
    val isModerator: Boolean = false,
    val isSubscriber: Boolean = false,
    val isMember: Boolean = false,
    val memberTier: VVMembershipTier? = null,
    val message: String,
    val timestamp: Instant,
    val isSuperchat: Boolean = false,
    val superchatAmount: Double? = null,
    val superchatCurrency: String? = null,
    val emotes: List<VVChatEmote> = emptyList(),
    val mentionedUsers: List<String> = emptyList()
)

data class VVChatEmote(
    val name: String,
    val url: String,
    val startIndex: Int,
    val endIndex: Int
)

// Analytics & Metrics Models
data class VVideoAnalytics(
    val videoId: String,
    val views: Long,
    val uniqueViewers: Long,
    val watchTime: Long, // total seconds watched
    val averageViewDuration: Double,
    val likes: Long,
    val dislikes: Long,
    val comments: Long,
    val shares: Long,
    val subscribersGained: Long,
    val subscribersLost: Long,
    val clickThroughRate: Float, // thumbnail CTR
    val retentionRate: Float, // average % watched
    val engagementRate: Float,
    val audienceRetention: List<VVRetentionPoint>,
    val trafficSources: Map<String, Long>, // "search" -> views
    val demographics: VVAudienceDemographics,
    val revenueData: VVRevenueData?
)

data class VVRetentionPoint(
    val timeSeconds: Int,
    val retentionPercentage: Float // 0.0 to 1.0
)

data class VVAudienceDemographics(
    val ageGroups: Map<String, Float>, // "18-24" -> 0.35
    val genders: Map<String, Float>, // "male" -> 0.6
    val countries: Map<String, Float>, // "TH" -> 0.8
    val devices: Map<String, Float> // "mobile" -> 0.7
)

data class VVRevenueData(
    val totalRevenue: Double,
    val currency: String,
    val adRevenue: Double,
    val membershipRevenue: Double,
    val superchatRevenue: Double,
    val merchandiseRevenue: Double
)

// Search & Discovery Models
data class VVideoSearchResult(
    val videos: List<VVVideoContent>,
    val channels: List<VVChannelInfo>,
    val playlists: List<VVVideoPlaylist>,
    val totalResults: Long,
    val searchQuery: String,
    val filters: VVSearchFilters,
    val suggestions: List<String>
)

data class VVSearchFilters(
    val type: VVSearchType = VVSearchType.ALL,
    val uploadDate: VVUploadDateFilter = VVUploadDateFilter.ANY,
    val duration: VVDurationFilter = VVDurationFilter.ANY,
    val features: List<VVVideoFeature> = emptyList(),
    val sortBy: VVSortBy = VVSortBy.RELEVANCE
)

enum class VVSearchType {
    ALL,
    VIDEOS,
    CHANNELS,
    PLAYLISTS,
    LIVE
}

enum class VVUploadDateFilter {
    ANY,
    LAST_HOUR,
    TODAY,
    THIS_WEEK,
    THIS_MONTH,
    THIS_YEAR
}

enum class VVDurationFilter {
    ANY,
    SHORT, // < 4 minutes
    MEDIUM, // 4-20 minutes
    LONG // > 20 minutes
}

enum class VVVideoFeature {
    LIVE,
    HD,
    SUBTITLES,
    CREATIVE_COMMONS,
    THREE_SIXTY,
    VR,
    HDR
}

enum class VVSortBy {
    RELEVANCE,
    UPLOAD_DATE,
    VIEW_COUNT,
    RATING
}

// Mock Data Generators
object VVideoMockData {
    fun generateShortVideos(): List<VVVideoContent> {
        return listOf(
            VVVideoContent(
                id = "short-1",
                title = "Amazing Pad Thai Street Food",
                description = "Learn how to make authentic Pad Thai in 60 seconds! üçú‚ú® #StreetFood #Thai #Cooking",
                thumbnail = "https://images.unsplash.com/photo-1559847844-5315695b6a77?w=400&h=700&fit=crop",
                videoUrl = "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
                duration = "0:45",
                durationSeconds = 45,
                views = 128000,
                likes = 8500,
                dislikes = 120,
                comments = 247,
                shares = 1200,
                bookmarks = 890,
                channel = generateChannel("thai-chef"),
                uploadTime = Clock.System.now(),
                uploadTimeFormatted = "2 hours ago",
                category = VVVideoCategory.FOOD,
                tags = listOf("food", "thai", "cooking", "street"),
                type = VVVideoType.SHORT
            ),
            VVVideoContent(
                id = "short-2",
                title = "Thai Dance Challenge",
                description = "Traditional Thai dance moves gone viral! Try this at home üíÉ #ThaiDance #Culture #Challenge",
                thumbnail = "https://images.unsplash.com/photo-1518611012118-696072aa579a?w=400&h=700&fit=crop",
                videoUrl = "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",
                duration = "0:30",
                durationSeconds = 30,
                views = 245000,
                likes = 15200,
                dislikes = 95,
                comments = 832,
                shares = 2100,
                bookmarks = 1450,
                channel = generateChannel("thai-culture"),
                uploadTime = Clock.System.now(),
                uploadTimeFormatted = "4 hours ago",
                category = VVVideoCategory.ENTERTAINMENT,
                tags = listOf("dance", "culture", "traditional", "viral"),
                type = VVVideoType.SHORT
            ),
            VVVideoContent(
                id = "short-3",
                title = "Bangkok Night Market Tour",
                description = "Best night market finds under 100 baht! üåÉüõçÔ∏è #Bangkok #Market #Shopping",
                thumbnail = "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=700&fit=crop",
                videoUrl = "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
                duration = "1:20",
                durationSeconds = 80,
                views = 67000,
                likes = 4300,
                dislikes = 45,
                comments = 156,
                shares = 890,
                bookmarks = 523,
                channel = generateChannel("bangkok-explorer"),
                uploadTime = Clock.System.now(),
                uploadTimeFormatted = "6 hours ago",
                category = VVVideoCategory.TRAVEL,
                tags = listOf("bangkok", "market", "shopping", "budget"),
                type = VVVideoType.SHORT
            )
        )
    }

    fun generateLongVideos(): List<VVVideoContent> {
        return listOf(
            VVVideoContent(
                id = "long-1",
                title = "Complete Guide to Thai Street Food: Bangkok Edition",
                description = "Join me as I explore the best street food vendors in Bangkok! From traditional Pad Thai to hidden gems, this comprehensive guide covers everything you need to know about Thai street food culture.",
                thumbnail = "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=225&fit=crop",
                videoUrl = "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4",
                duration = "15:43",
                durationSeconds = 943,
                views = 524000,
                likes = 18500,
                dislikes = 234,
                comments = 1842,
                shares = 3200,
                bookmarks = 5600,
                channel = generateChannel("foodie-adventures"),
                uploadTime = Clock.System.now(),
                uploadTimeFormatted = "1 day ago",
                category = VVVideoCategory.FOOD,
                tags = listOf("street food", "bangkok", "thai cuisine", "travel"),
                type = VVVideoType.LONG
            ),
            VVVideoContent(
                id = "long-2",
                title = "Thai Language Crash Course for Travelers",
                description = "Learn essential Thai phrases for your trip to Thailand! Perfect for beginners who want to communicate with locals and enhance their travel experience.",
                thumbnail = "https://images.unsplash.com/photo-1544717297-fa95b6ee9643?w=400&h=225&fit=crop",
                videoUrl = "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4",
                duration = "22:18",
                durationSeconds = 1338,
                views = 156000,
                likes = 9200,
                dislikes = 89,
                comments = 567,
                shares = 1100,
                bookmarks = 2300,
                channel = generateChannel("learn-thai"),
                uploadTime = Clock.System.now(),
                uploadTimeFormatted = "2 days ago",
                category = VVVideoCategory.EDUCATION,
                tags = listOf("thai language", "education", "travel", "learning"),
                type = VVVideoType.LONG
            )
        )
    }

    fun generateChannels(): List<VVChannelInfo> {
        return listOf(
            generateChannel("thai-chef"),
            generateChannel("thai-culture"),
            generateChannel("bangkok-explorer"),
            generateChannel("foodie-adventures"),
            generateChannel("learn-thai")
        )
    }

    private fun generateChannel(id: String): VVChannelInfo {
        return when (id) {
            "thai-chef" -> VVChannelInfo(
                id = id,
                name = "Bangkok Street Chef",
                avatar = "https://images.unsplash.com/photo-1595273670150-bd0c3c392e46?w=150&h=150&fit=crop",
                banner = "https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800&h=200&fit=crop",
                description = "Authentic Thai street food recipes and cooking techniques from Bangkok's best chefs.",
                subscribers = 45000,
                totalVideos = 234,
                verified = true,
                category = VVVideoCategory.FOOD,
                joinedDate = "Jan 2020",
                location = "Bangkok, Thailand"
            )
            "thai-culture" -> VVChannelInfo(
                id = id,
                name = "Thai Culture Hub",
                avatar = "https://images.unsplash.com/photo-1494790108755-2616b612b820?w=150&h=150&fit=crop",
                banner = "https://images.unsplash.com/photo-1528181304800-259b08848526?w=800&h=200&fit=crop",
                description = "Explore the rich culture, traditions, and modern life of Thailand through our videos.",
                subscribers = 89000,
                totalVideos = 156,
                verified = true,
                category = VVVideoCategory.ENTERTAINMENT,
                joinedDate = "Mar 2019",
                location = "Chiang Mai, Thailand"
            )
            "bangkok-explorer" -> VVChannelInfo(
                id = id,
                name = "Bangkok Explorer",
                avatar = "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop",
                banner = "https://images.unsplash.com/photo-1508009603885-50cf7c579365?w=800&h=200&fit=crop",
                description = "Your guide to the best spots in Bangkok - from hidden gems to popular attractions.",
                subscribers = 32000,
                totalVideos = 89,
                verified = false,
                category = VVVideoCategory.TRAVEL,
                joinedDate = "Aug 2021",
                location = "Bangkok, Thailand"
            )
            "foodie-adventures" -> VVChannelInfo(
                id = id,
                name = "Southeast Asian Foodie",
                avatar = "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop",
                banner = "https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800&h=200&fit=crop",
                description = "Food adventures across Southeast Asia. Discover the best local cuisines and hidden food gems.",
                subscribers = 235000,
                totalVideos = 412,
                verified = true,
                category = VVVideoCategory.FOOD,
                joinedDate = "Jun 2018",
                location = "Singapore"
            )
            "learn-thai" -> VVChannelInfo(
                id = id,
                name = "Thai Language Academy",
                avatar = "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop",
                banner = "https://images.unsplash.com/photo-1544717297-fa95b6ee9643?w=800&h=200&fit=crop",
                description = "Learn Thai language easily with our structured lessons and practical conversations.",
                subscribers = 87000,
                totalVideos = 178,
                verified = true,
                category = VVVideoCategory.EDUCATION,
                joinedDate = "Feb 2020",
                location = "Bangkok, Thailand"
            )
            else -> VVChannelInfo(
                id = id,
                name = "Unknown Channel",
                avatar = "",
                description = "",
                subscribers = 0,
                totalVideos = 0,
                verified = false,
                category = VVVideoCategory.ALL,
                joinedDate = "Unknown"
            )
        }
    }

    fun formatViews(views: Long): String {
        return when {
            views >= 1000000 -> {
                val millions = views / 1000000.0
                if (millions % 1 == 0.0) "${millions.toInt()}M" else "${(millions * 10).toInt() / 10.0}M"
            }
            views >= 1000 -> {
                val thousands = views / 1000.0
                if (thousands % 1 == 0.0) "${thousands.toInt()}K" else "${(thousands * 10).toInt() / 10.0}K"
            }
            else -> views.toString()
        }
    }

    fun formatSubscribers(subs: Long): String = formatViews(subs)
}